import{N as g,p as x,m as L,w as b,g as K,r as $,E as O,i as I,a as V,b as X,c as S,d as z}from"./index-ek6y0BNb.js";var F=Object.defineProperty,G=(t,e)=>{for(var s in e)F(t,s,{get:e[s],enumerable:!0})},W="listItem",w="textStyle",C=/^\s*([-+*])\s$/,q=g.create({name:"bulletList",addOptions(){return{itemTypeName:"listItem",HTMLAttributes:{},keepMarks:!1,keepAttributes:!1}},group:"block list",content(){return`${this.options.itemTypeName}+`},parseHTML(){return[{tag:"ul"}]},renderHTML({HTMLAttributes:t}){return["ul",L(this.options.HTMLAttributes,t),0]},markdownTokenName:"list",parseMarkdown:(t,e)=>t.type!=="list"||t.ordered?[]:{type:"bulletList",content:t.items?e.parseChildren(t.items):[]},renderMarkdown:(t,e)=>t.content?e.renderChildren(t.content,`
`):"",markdownOptions:{indentsContent:!0},addCommands(){return{toggleBulletList:()=>({commands:t,chain:e})=>this.options.keepAttributes?e().toggleList(this.name,this.options.itemTypeName,this.options.keepMarks).updateAttributes(W,this.editor.getAttributes(w)).run():t.toggleList(this.name,this.options.itemTypeName,this.options.keepMarks)}},addKeyboardShortcuts(){return{"Mod-Shift-8":()=>this.editor.commands.toggleBulletList()}},addInputRules(){let t=b({find:C,type:this.type});return(this.options.keepMarks||this.options.keepAttributes)&&(t=b({find:C,type:this.type,keepMarks:this.options.keepMarks,keepAttributes:this.options.keepAttributes,getAttributes:()=>this.editor.getAttributes(w),editor:this.editor})),[t]}}),Y=g.create({name:"listItem",addOptions(){return{HTMLAttributes:{},bulletListTypeName:"bulletList",orderedListTypeName:"orderedList"}},content:"paragraph block*",defining:!0,parseHTML(){return[{tag:"li"}]},renderHTML({HTMLAttributes:t}){return["li",L(this.options.HTMLAttributes,t),0]},markdownTokenName:"list_item",parseMarkdown:(t,e)=>{if(t.type!=="list_item")return[];let s=[];if(t.tokens&&t.tokens.length>0)if(t.tokens.some(r=>r.type==="paragraph"))s=e.parseChildren(t.tokens);else{const r=t.tokens[0];if(r&&r.type==="text"&&r.tokens&&r.tokens.length>0){if(s=[{type:"paragraph",content:e.parseInline(r.tokens)}],t.tokens.length>1){const d=t.tokens.slice(1),a=e.parseChildren(d);s.push(...a)}}else s=e.parseChildren(t.tokens)}return s.length===0&&(s=[{type:"paragraph",content:[]}]),{type:"listItem",content:s}},renderMarkdown:(t,e,s)=>$(t,e,n=>n.parentType==="bulletList"?"- ":n.parentType==="orderedList"?`${n.index+1}. `:"- ",s),addKeyboardShortcuts(){return{Enter:()=>this.editor.commands.splitListItem(this.name),Tab:()=>this.editor.commands.sinkListItem(this.name),"Shift-Tab":()=>this.editor.commands.liftListItem(this.name)}}}),J={};G(J,{findListItemPos:()=>y,getNextListDepth:()=>A,handleBackspace:()=>T,handleDelete:()=>M,hasListBefore:()=>P,hasListItemAfter:()=>Q,hasListItemBefore:()=>_,listItemHasSubList:()=>D,nextListIsDeeper:()=>R,nextListIsHigher:()=>j});var y=(t,e)=>{const{$from:s}=e.selection,n=S(t,e.schema);let r=null,i=s.depth,d=s.pos,a=null;for(;i>0&&a===null;)r=s.node(i),r.type===n?a=i:(i-=1,d-=1);return a===null?null:{$pos:e.doc.resolve(d),depth:a}},A=(t,e)=>{const s=y(t,e);if(!s)return!1;const[,n]=z(e,t,s.$pos.pos+4);return n},P=(t,e,s)=>{const{$anchor:n}=t.selection,r=Math.max(0,n.pos-2),i=t.doc.resolve(r).node();return!(!i||!s.includes(i.type.name))},_=(t,e)=>{var s;const{$anchor:n}=e.selection,r=e.doc.resolve(n.pos-2);return!(r.index()===0||((s=r.nodeBefore)==null?void 0:s.type.name)!==t)},D=(t,e,s)=>{if(!s)return!1;const n=S(t,e.schema);let r=!1;return s.descendants(i=>{i.type===n&&(r=!0)}),r},T=(t,e,s)=>{if(t.commands.undoInputRule())return!0;if(t.state.selection.from!==t.state.selection.to)return!1;if(!I(t.state,e)&&P(t.state,e,s)){const{$anchor:a}=t.state.selection,l=t.state.doc.resolve(a.before()-1),p=[];l.node().descendants((c,u)=>{c.type.name===e&&p.push({node:c,pos:u})});const h=p.at(-1);if(!h)return!1;const o=t.state.doc.resolve(l.start()+h.pos+1);return t.chain().cut({from:a.start()-1,to:a.end()+1},o.end()).joinForward().run()}if(!I(t.state,e)||!V(t.state))return!1;const n=y(e,t.state);if(!n)return!1;const i=t.state.doc.resolve(n.$pos.pos-2).node(n.depth),d=D(e,t.state,i);return _(e,t.state)&&!d?t.commands.joinItemBackward():t.chain().liftListItem(e).run()},R=(t,e)=>{const s=A(t,e),n=y(t,e);return!n||!s?!1:s>n.depth},j=(t,e)=>{const s=A(t,e),n=y(t,e);return!n||!s?!1:s<n.depth},M=(t,e)=>{if(!I(t.state,e)||!X(t.state,e))return!1;const{selection:s}=t.state,{$from:n,$to:r}=s;return!s.empty&&n.sameParent(r)?!1:R(e,t.state)?t.chain().focus(t.state.selection.from+4).lift(e).joinBackward().run():j(e,t.state)?t.chain().joinForward().joinBackward().run():t.commands.joinItemForward()},Q=(t,e)=>{var s;const{$anchor:n}=e.selection,r=e.doc.resolve(n.pos-n.parentOffset-2);return!(r.index()===r.parent.childCount-1||((s=r.nodeAfter)==null?void 0:s.type.name)!==t)},U=O.create({name:"listKeymap",addOptions(){return{listTypes:[{itemName:"listItem",wrapperNames:["bulletList","orderedList"]},{itemName:"taskItem",wrapperNames:["taskList"]}]}},addKeyboardShortcuts(){return{Delete:({editor:t})=>{let e=!1;return this.options.listTypes.forEach(({itemName:s})=>{t.state.schema.nodes[s]!==void 0&&M(t,s)&&(e=!0)}),e},"Mod-Delete":({editor:t})=>{let e=!1;return this.options.listTypes.forEach(({itemName:s})=>{t.state.schema.nodes[s]!==void 0&&M(t,s)&&(e=!0)}),e},Backspace:({editor:t})=>{let e=!1;return this.options.listTypes.forEach(({itemName:s,wrapperNames:n})=>{t.state.schema.nodes[s]!==void 0&&T(t,s,n)&&(e=!0)}),e},"Mod-Backspace":({editor:t})=>{let e=!1;return this.options.listTypes.forEach(({itemName:s,wrapperNames:n})=>{t.state.schema.nodes[s]!==void 0&&T(t,s,n)&&(e=!0)}),e}}}}),N=/^(\s*)(\d+)\.\s+(.*)$/,Z=/^\s/;function tt(t){const e=[];let s=0,n=0;for(;s<t.length;){const r=t[s],i=r.match(N);if(!i)break;const[,d,a,l]=i,p=d.length;let h=l,o=s+1;const c=[r];for(;o<t.length;){const u=t[o];if(u.match(N))break;if(u.trim()==="")c.push(u),h+=`
`,o+=1;else if(u.match(Z))c.push(u),h+=`
${u.slice(p+2)}`,o+=1;else break}e.push({indent:p,number:parseInt(a,10),content:h.trim(),raw:c.join(`
`)}),n=o,s=o}return[e,n]}function B(t,e,s){var n;const r=[];let i=0;for(;i<t.length;){const d=t[i];if(d.indent===e){const a=d.content.split(`
`),l=((n=a[0])==null?void 0:n.trim())||"",p=[];l&&p.push({type:"paragraph",raw:l,tokens:s.inlineTokens(l)});const h=a.slice(1).join(`
`).trim();if(h){const u=s.blockTokens(h);p.push(...u)}let o=i+1;const c=[];for(;o<t.length&&t[o].indent>e;)c.push(t[o]),o+=1;if(c.length>0){const u=Math.min(...c.map(m=>m.indent)),k=B(c,u,s);p.push({type:"list",ordered:!0,start:c[0].number,items:k,raw:c.map(m=>m.raw).join(`
`)})}r.push({type:"list_item",raw:d.raw,tokens:p}),i=o}else i+=1}return r}function et(t,e){return t.map(s=>{if(s.type!=="list_item")return e.parseChildren([s])[0];const n=[];return s.tokens&&s.tokens.length>0&&s.tokens.forEach(r=>{if(r.type==="paragraph"||r.type==="list"||r.type==="blockquote"||r.type==="code")n.push(...e.parseChildren([r]));else if(r.type==="text"&&r.tokens){const i=e.parseChildren([r]);n.push({type:"paragraph",content:i})}else{const i=e.parseChildren([r]);i.length>0&&n.push(...i)}}),{type:"listItem",content:n}})}var st="listItem",E="textStyle",H=/^(\d+)\.\s$/,nt=g.create({name:"orderedList",addOptions(){return{itemTypeName:"listItem",HTMLAttributes:{},keepMarks:!1,keepAttributes:!1}},group:"block list",content(){return`${this.options.itemTypeName}+`},addAttributes(){return{start:{default:1,parseHTML:t=>t.hasAttribute("start")?parseInt(t.getAttribute("start")||"",10):1},type:{default:null,parseHTML:t=>t.getAttribute("type")}}},parseHTML(){return[{tag:"ol"}]},renderHTML({HTMLAttributes:t}){const{start:e,...s}=t;return e===1?["ol",L(this.options.HTMLAttributes,s),0]:["ol",L(this.options.HTMLAttributes,t),0]},markdownTokenName:"list",parseMarkdown:(t,e)=>{if(t.type!=="list"||!t.ordered)return[];const s=t.start||1,n=t.items?et(t.items,e):[];return s!==1?{type:"orderedList",attrs:{start:s},content:n}:{type:"orderedList",content:n}},renderMarkdown:(t,e)=>t.content?e.renderChildren(t.content,`
`):"",markdownTokenizer:{name:"orderedList",level:"block",start:t=>{const e=t.match(/^(\s*)(\d+)\.\s+/),s=e?.index;return s!==void 0?s:-1},tokenize:(t,e,s)=>{var n;const r=t.split(`
`),[i,d]=tt(r);if(i.length===0)return;const a=B(i,0,s);return a.length===0?void 0:{type:"list",ordered:!0,start:((n=i[0])==null?void 0:n.number)||1,items:a,raw:r.slice(0,d).join(`
`)}}},markdownOptions:{indentsContent:!0},addCommands(){return{toggleOrderedList:()=>({commands:t,chain:e})=>this.options.keepAttributes?e().toggleList(this.name,this.options.itemTypeName,this.options.keepMarks).updateAttributes(st,this.editor.getAttributes(E)).run():t.toggleList(this.name,this.options.itemTypeName,this.options.keepMarks)}},addKeyboardShortcuts(){return{"Mod-Shift-7":()=>this.editor.commands.toggleOrderedList()}},addInputRules(){let t=b({find:H,type:this.type,getAttributes:e=>({start:+e[1]}),joinPredicate:(e,s)=>s.childCount+s.attrs.start===+e[1]});return(this.options.keepMarks||this.options.keepAttributes)&&(t=b({find:H,type:this.type,keepMarks:this.options.keepMarks,keepAttributes:this.options.keepAttributes,getAttributes:e=>({start:+e[1],...this.editor.getAttributes(E)}),joinPredicate:(e,s)=>s.childCount+s.attrs.start===+e[1],editor:this.editor})),[t]}}),rt=/^\s*(\[([( |x])?\])\s$/,it=g.create({name:"taskItem",addOptions(){return{nested:!1,HTMLAttributes:{},taskListTypeName:"taskList",a11y:void 0}},content(){return this.options.nested?"paragraph block*":"paragraph+"},defining:!0,addAttributes(){return{checked:{default:!1,keepOnSplit:!1,parseHTML:t=>{const e=t.getAttribute("data-checked");return e===""||e==="true"},renderHTML:t=>({"data-checked":t.checked})}}},parseHTML(){return[{tag:`li[data-type="${this.name}"]`,priority:51}]},renderHTML({node:t,HTMLAttributes:e}){return["li",L(this.options.HTMLAttributes,e,{"data-type":this.name}),["label",["input",{type:"checkbox",checked:t.attrs.checked?"checked":null}],["span"]],["div",0]]},parseMarkdown:(t,e)=>{const s=[];if(t.tokens&&t.tokens.length>0?s.push(e.createNode("paragraph",{},e.parseInline(t.tokens))):t.text?s.push(e.createNode("paragraph",{},[e.createNode("text",{text:t.text})])):s.push(e.createNode("paragraph",{},[])),t.nestedTokens&&t.nestedTokens.length>0){const n=e.parseChildren(t.nestedTokens);s.push(...n)}return e.createNode("taskItem",{checked:t.checked||!1},s)},renderMarkdown:(t,e)=>{var s;const r=`- [${(s=t.attrs)!=null&&s.checked?"x":" "}] `;return $(t,e,r)},addKeyboardShortcuts(){const t={Enter:()=>this.editor.commands.splitListItem(this.name),"Shift-Tab":()=>this.editor.commands.liftListItem(this.name)};return this.options.nested?{...t,Tab:()=>this.editor.commands.sinkListItem(this.name)}:t},addNodeView(){return({node:t,HTMLAttributes:e,getPos:s,editor:n})=>{const r=document.createElement("li"),i=document.createElement("label"),d=document.createElement("span"),a=document.createElement("input"),l=document.createElement("div"),p=o=>{var c,u;a.ariaLabel=((u=(c=this.options.a11y)==null?void 0:c.checkboxLabel)==null?void 0:u.call(c,o,a.checked))||`Task item checkbox for ${o.textContent||"empty task item"}`};p(t),i.contentEditable="false",a.type="checkbox",a.addEventListener("mousedown",o=>o.preventDefault()),a.addEventListener("change",o=>{if(!n.isEditable&&!this.options.onReadOnlyChecked){a.checked=!a.checked;return}const{checked:c}=o.target;n.isEditable&&typeof s=="function"&&n.chain().focus(void 0,{scrollIntoView:!1}).command(({tr:u})=>{const k=s();if(typeof k!="number")return!1;const m=u.doc.nodeAt(k);return u.setNodeMarkup(k,void 0,{...m?.attrs,checked:c}),!0}).run(),!n.isEditable&&this.options.onReadOnlyChecked&&(this.options.onReadOnlyChecked(t,c)||(a.checked=!a.checked))}),Object.entries(this.options.HTMLAttributes).forEach(([o,c])=>{r.setAttribute(o,c)}),r.dataset.checked=t.attrs.checked,a.checked=t.attrs.checked,i.append(a,d),r.append(i,l),Object.entries(e).forEach(([o,c])=>{r.setAttribute(o,c)});let h=new Set(Object.keys(e));return{dom:r,contentDOM:l,update:o=>{if(o.type!==this.type)return!1;r.dataset.checked=o.attrs.checked,a.checked=o.attrs.checked,p(o);const c=n.extensionManager.attributes,u=K(o,c),k=new Set(Object.keys(u)),m=this.options.HTMLAttributes;return h.forEach(f=>{k.has(f)||(f in m?r.setAttribute(f,m[f]):r.removeAttribute(f))}),Object.entries(u).forEach(([f,v])=>{v==null?f in m?r.setAttribute(f,m[f]):r.removeAttribute(f):r.setAttribute(f,v)}),h=k,!0}}}},addInputRules(){return[b({find:rt,type:this.type,getAttributes:t=>({checked:t[t.length-1]==="x"})})]}}),at=g.create({name:"taskList",addOptions(){return{itemTypeName:"taskItem",HTMLAttributes:{}}},group:"block list",content(){return`${this.options.itemTypeName}+`},parseHTML(){return[{tag:`ul[data-type="${this.name}"]`,priority:51}]},renderHTML({HTMLAttributes:t}){return["ul",L(this.options.HTMLAttributes,t,{"data-type":this.name}),0]},parseMarkdown:(t,e)=>e.createNode("taskList",{},e.parseChildren(t.items||[])),renderMarkdown:(t,e)=>t.content?e.renderChildren(t.content,`
`):"",markdownTokenizer:{name:"taskList",level:"block",start(t){var e;const s=(e=t.match(/^\s*[-+*]\s+\[([ xX])\]\s+/))==null?void 0:e.index;return s!==void 0?s:-1},tokenize(t,e,s){const n=i=>{const d=x(i,{itemPattern:/^(\s*)([-+*])\s+\[([ xX])\]\s+(.*)$/,extractItemData:a=>({indentLevel:a[1].length,mainContent:a[4],checked:a[3].toLowerCase()==="x"}),createToken:(a,l)=>({type:"taskItem",raw:"",mainContent:a.mainContent,indentLevel:a.indentLevel,checked:a.checked,text:a.mainContent,tokens:s.inlineTokens(a.mainContent),nestedTokens:l}),customNestedParser:n},s);return d?[{type:"taskList",raw:d.raw,items:d.items}]:s.blockTokens(i)},r=x(t,{itemPattern:/^(\s*)([-+*])\s+\[([ xX])\]\s+(.*)$/,extractItemData:i=>({indentLevel:i[1].length,mainContent:i[4],checked:i[3].toLowerCase()==="x"}),createToken:(i,d)=>({type:"taskItem",raw:"",mainContent:i.mainContent,indentLevel:i.indentLevel,checked:i.checked,text:i.mainContent,tokens:s.inlineTokens(i.mainContent),nestedTokens:d}),customNestedParser:n},s);if(r)return{type:"taskList",raw:r.raw,items:r.items}}},markdownOptions:{indentsContent:!0},addCommands(){return{toggleTaskList:()=>({commands:t})=>t.toggleList(this.name,this.options.itemTypeName)}},addKeyboardShortcuts(){return{"Mod-Shift-9":()=>this.editor.commands.toggleTaskList()}}});O.create({name:"listKit",addExtensions(){const t=[];return this.options.bulletList!==!1&&t.push(q.configure(this.options.bulletList)),this.options.listItem!==!1&&t.push(Y.configure(this.options.listItem)),this.options.listKeymap!==!1&&t.push(U.configure(this.options.listKeymap)),this.options.orderedList!==!1&&t.push(nt.configure(this.options.orderedList)),this.options.taskItem!==!1&&t.push(it.configure(this.options.taskItem)),this.options.taskList!==!1&&t.push(at.configure(this.options.taskList)),t}});export{q as B,Y as L,nt as O,at as T,it as a,U as b};
