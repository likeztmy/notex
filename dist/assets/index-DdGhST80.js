import{N as C,P as k,h as w,T as S,l as T,S as B,m as L}from"./index-ek6y0BNb.js";var y=4,M=/^```([a-z]+)?[\s\n]$/,N=/^~~~([a-z]+)?[\s\n]$/,P=C.create({name:"codeBlock",addOptions(){return{languageClassPrefix:"language-",exitOnTripleEnter:!0,exitOnArrowDown:!0,defaultLanguage:null,enableTabIndentation:!1,tabSize:y,HTMLAttributes:{}}},content:"text*",marks:"",group:"block",code:!0,defining:!0,addAttributes(){return{language:{default:this.options.defaultLanguage,parseHTML:e=>{var t;const{languageClassPrefix:a}=this.options;if(!a)return null;const o=[...((t=e.firstElementChild)==null?void 0:t.classList)||[]].filter(s=>s.startsWith(a)).map(s=>s.replace(a,""))[0];return o||null},rendered:!1}}},parseHTML(){return[{tag:"pre",preserveWhitespace:"full"}]},renderHTML({node:e,HTMLAttributes:t}){return["pre",L(this.options.HTMLAttributes,t),["code",{class:e.attrs.language?this.options.languageClassPrefix+e.attrs.language:null},0]]},markdownTokenName:"code",parseMarkdown:(e,t)=>{var a;return((a=e.raw)==null?void 0:a.startsWith("```"))===!1&&e.codeBlockStyle!=="indented"?[]:t.createNode("codeBlock",{language:e.lang||null},e.text?[t.createTextNode(e.text)]:[])},renderMarkdown:(e,t)=>{var a;let n="";const r=((a=e.attrs)==null?void 0:a.language)||"";return e.content?n=[`\`\`\`${r}`,t.renderChildren(e.content),"```"].join(`
`):n=`\`\`\`${r}

\`\`\``,n},addCommands(){return{setCodeBlock:e=>({commands:t})=>t.setNode(this.name,e),toggleCodeBlock:e=>({commands:t})=>t.toggleNode(this.name,"paragraph",e)}},addKeyboardShortcuts(){return{"Mod-Alt-c":()=>this.editor.commands.toggleCodeBlock(),Backspace:()=>{const{empty:e,$anchor:t}=this.editor.state.selection,a=t.pos===1;return!e||t.parent.type.name!==this.name?!1:a||!t.parent.textContent.length?this.editor.commands.clearNodes():!1},Tab:({editor:e})=>{var t;if(!this.options.enableTabIndentation)return!1;const a=(t=this.options.tabSize)!=null?t:y,{state:n}=e,{selection:r}=n,{$from:o,empty:s}=r;if(o.parent.type!==this.type)return!1;const i=" ".repeat(a);return s?e.commands.insertContent(i):e.commands.command(({tr:l})=>{const{from:c,to:f}=r,u=n.doc.textBetween(c,f,`
`,`
`).split(`
`).map(p=>i+p).join(`
`);return l.replaceWith(c,f,n.schema.text(u)),!0})},"Shift-Tab":({editor:e})=>{var t;if(!this.options.enableTabIndentation)return!1;const a=(t=this.options.tabSize)!=null?t:y,{state:n}=e,{selection:r}=n,{$from:o,empty:s}=r;return o.parent.type!==this.type?!1:s?e.commands.command(({tr:i})=>{var l;const{pos:c}=o,f=o.start(),h=o.end(),u=n.doc.textBetween(f,h,`
`,`
`).split(`
`);let p=0,g=0;const b=c-f;for(let d=0;d<u.length;d+=1){if(g+u[d].length>=b){p=d;break}g+=u[d].length+1}const A=((l=u[p].match(/^ */))==null?void 0:l[0])||"",v=Math.min(A.length,a);if(v===0)return!0;let m=f;for(let d=0;d<p;d+=1)m+=u[d].length+1;return i.delete(m,m+v),c-m<=v&&i.setSelection(S.create(i.doc,m)),!0}):e.commands.command(({tr:i})=>{const{from:l,to:c}=r,x=n.doc.textBetween(l,c,`
`,`
`).split(`
`).map(u=>{var p;const g=((p=u.match(/^ */))==null?void 0:p[0])||"",b=Math.min(g.length,a);return u.slice(b)}).join(`
`);return i.replaceWith(l,c,n.schema.text(x)),!0})},Enter:({editor:e})=>{if(!this.options.exitOnTripleEnter)return!1;const{state:t}=e,{selection:a}=t,{$from:n,empty:r}=a;if(!r||n.parent.type!==this.type)return!1;const o=n.parentOffset===n.parent.nodeSize-2,s=n.parent.textContent.endsWith(`

`);return!o||!s?!1:e.chain().command(({tr:i})=>(i.delete(n.pos-2,n.pos),!0)).exitCode().run()},ArrowDown:({editor:e})=>{if(!this.options.exitOnArrowDown)return!1;const{state:t}=e,{selection:a,doc:n}=t,{$from:r,empty:o}=a;if(!o||r.parent.type!==this.type||!(r.parentOffset===r.parent.nodeSize-2))return!1;const i=r.after();return i===void 0?!1:n.nodeAt(i)?e.commands.command(({tr:c})=>(c.setSelection(B.near(n.resolve(i))),!0)):e.commands.exitCode()}}},addInputRules(){return[T({find:M,type:this.type,getAttributes:e=>({language:e[1]})}),T({find:N,type:this.type,getAttributes:e=>({language:e[1]})})]},addProseMirrorPlugins(){return[new k({key:new w("codeBlockVSCodeHandler"),props:{handlePaste:(e,t)=>{if(!t.clipboardData||this.editor.isActive(this.type.name))return!1;const a=t.clipboardData.getData("text/plain"),n=t.clipboardData.getData("vscode-editor-data"),r=n?JSON.parse(n):void 0,o=r?.mode;if(!a||!o)return!1;const{tr:s,schema:i}=e.state,l=i.text(a.replace(/\r\n?/g,`
`));return s.replaceSelectionWith(this.type.create({language:o},l)),s.selection.$from.parent.type!==this.type&&s.setSelection(S.near(s.doc.resolve(Math.max(0,s.selection.from-2)))),s.setMeta("paste",!0),e.dispatch(s),!0}}})]}}),_=P;export{P as C,_ as i};
