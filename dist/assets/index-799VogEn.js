import{i as x}from"./index-DdGhST80.js";import{P as y,h as w,j as p,D as N,k as L}from"./index-ek6y0BNb.js";import{H as P}from"./core-C8MVj649.js";import"./index-MvcxFbVf.js";function v(e,r=[]){return e.flatMap(t=>{const a=[...r,...t.properties?t.properties.className:[]];return t.children?v(t.children,a):{text:t.value,classes:a}})}function f(e){return e.value||e.children||[]}function C(e){return!!P.getLanguage(e)}function m({doc:e,name:r,lowlight:t,defaultLanguage:a}){const n=[];return p(e,i=>i.type.name===r).forEach(i=>{var u;let l=i.pos+1;const s=i.node.attrs.language||a,h=t.listLanguages(),c=s&&(h.includes(s)||C(s)||(u=t.registered)!=null&&u.call(t,s))?f(t.highlight(s,i.node.textContent)):f(t.highlightAuto(i.node.textContent));v(c).forEach(g=>{const o=l+g.text.length;if(g.classes.length){const d=N.inline(l,o,{class:g.classes.join(" ")});n.push(d)}l=o})}),L.create(e,n)}function _(e){return typeof e=="function"}function D({name:e,lowlight:r,defaultLanguage:t}){if(!["highlight","highlightAuto","listLanguages"].every(n=>_(r[n])))throw Error("You should provide an instance of lowlight to use the code-block-lowlight extension");const a=new y({key:new w("lowlight"),state:{init:(n,{doc:i})=>m({doc:i,name:e,lowlight:r,defaultLanguage:t}),apply:(n,i,u,l)=>{const s=u.selection.$head.parent.type.name,h=l.selection.$head.parent.type.name,c=p(u.doc,o=>o.type.name===e),g=p(l.doc,o=>o.type.name===e);return n.docChanged&&([s,h].includes(e)||g.length!==c.length||n.steps.some(o=>o.from!==void 0&&o.to!==void 0&&c.some(d=>d.pos>=o.from&&d.pos+d.node.nodeSize<=o.to)))?m({doc:n.doc,name:e,lowlight:r,defaultLanguage:t}):i.map(n.mapping,n.doc)}},props:{decorations(n){return a.getState(n)}}});return a}var A=x.extend({addOptions(){var e;return{...(e=this.parent)==null?void 0:e.call(this),lowlight:{},languageClassPrefix:"language-",exitOnTripleEnter:!0,exitOnArrowDown:!0,defaultLanguage:null,enableTabIndentation:!1,tabSize:4,HTMLAttributes:{}}},addProseMirrorPlugins(){var e;return[...((e=this.parent)==null?void 0:e.call(this))||[],D({name:this.name,lowlight:this.options.lowlight,defaultLanguage:this.options.defaultLanguage})]}}),S=A;export{A as CodeBlockLowlight,S as default};
